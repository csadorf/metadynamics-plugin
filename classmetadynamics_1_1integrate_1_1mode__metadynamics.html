<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>metadynamics: mode_metadynamics Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">metadynamics
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>metadynamics</b></li><li class="navelem"><a class="el" href="namespacemetadynamics_1_1integrate.html">integrate</a></li><li class="navelem"><a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html">mode_metadynamics</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">mode_metadynamics Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Enables integration using metadynamics, a free energy technique. </p>
<p>The command <a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html" title="Enables integration using metadynamics, a free energy technique.">integrate.mode_metadynamics</a> sets up MD integration with an arbitrary integration method (such as NVT), to continuously samples the collective variables and uses their values to update the bias potential, from which forces are calculated.</p>
<p>Some features of this package are loosely inspired by the PLUMED plugin for Metadynamics, <a href="http://www.plumed-code.org/">http://www.plumed-code.org/</a>.</p>
<p>The metadynamics algorithm is reviewed in detail in <a href="http://dx.doi.org/10.1002/wcms.31">Barducci et al., Metadynamics, Wiley Interdiscipl. Rev.: Comput. Mol. Sci. 5, pp. 826-843 (2011)</a></p>
<p>Explictly, the metadynamics biasing potential <img class="formulaInl" alt="$V(s,t)$" src="form_17.png"/> at time <img class="formulaInl" alt="$t$" src="form_18.png"/> takes the form </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ V(\mathbf{s}, t) = \sum\limits_{t'=0, t_G, 2 t_G,\dots}^{t'<t} W e^{-\frac{V[\mathbf{s}(\mathbf{r}(t')]}{\Delta T}} \exp\left\{-\sum\limits_{i=1}^d \frac{[s_i(\mathbf{r}) - s_i(\mathbf{r}(t'))]^2}{2\sigma_i^2}\right\}, \]" src="form_19.png"/>
</p>
<p> where</p>
<ul>
<li><img class="formulaInl" alt="$ s $" src="form_0.png"/> is the vector of collective variables</li>
<li><img class="formulaInl" alt="$ t_G $" src="form_20.png"/> is the stride (in time units). It should be chosen on the order of several <img class="formulaInl" alt="$\tau$" src="form_21.png"/> , where <img class="formulaInl" alt="$\tau$" src="form_21.png"/> is a typical internal relaxation time of the system.</li>
<li><img class="formulaInl" alt="$ W $" src="form_22.png"/> is the height of Gaussians added during the simulation (in energy units).</li>
<li><img class="formulaInl" alt="$ \sigma_i $" src="form_23.png"/> is the standard deviation of Gaussian added for collective variable <img class="formulaInl" alt="$i$" src="form_4.png"/></li>
</ul>
<p>Before a metadynamics run, the collective variables need to be defined and the integration methods need to specified. Currently, the only collective variable available is</p>
<ul>
<li><a class="el" href="classmetadynamics_1_1cv_1_1lamellar.html" title="Lamellar order parameter as a collective variable to study phase transitions in block copolymer syste...">cv.lamellar</a></li>
</ul>
<p>While metadynamics in principle works independently of the integration method, it has thus far been tested with</p>
<ul>
<li><b>integrate.nvt</b> </li>
</ul>
<p>only.</p>
<p>During a metadynamics run, the potential is updated every <img class="formulaInl" alt="$ t_G/\Delta t$" src="form_24.png"/> steps and forces derived from the potential are applied to the particles every step.</p>
<p>The result of a metadynamics run is either a hills file (which contains the positions and heights of Gaussians that are added together to form the bias potential), or a bias potential evaluated on a grid. The negative of the bias potential can be used to calculate the free energy surface (FES).</p>
<p>By default, <a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html" title="Enables integration using metadynamics, a free energy technique.">integrate.mode_metadynamics</a> uses the <em>well-tempered</em> variant of metadynamics, where a shift temperature <img class="formulaInl" alt="$ \Delta T$" src="form_25.png"/> is defined, which converges to a well-defined bias potential after a typical time for convergence that depends entirely on the system simulated and on the value of <img class="formulaInl" alt="$ \Delta T$" src="form_25.png"/>. The latter quantity should be chosen such that <img class="formulaInl" alt="$ (\Delta T + T) k_B T$" src="form_26.png"/> equals the typical height of free energy barriers in the system.</p>
<p>By contrast, <em>standard</em> metadynamics does not converge to a limiting potential, and thus the free energy landscape is 'overfilled'. Standard metadynamics corresponds to <img class="formulaInl" alt="$\Delta T = \infty$" src="form_27.png"/>. If the goal is to approximate standard metadynamics, large values (e.g. <img class="formulaInl" alt="$\Delta T = 100$" src="form_28.png"/>) of the temperature shift can therefore be used.</p>
<dl class="section note"><dt>Note:</dt><dd>The collective variables need to be defined before the first call to <b>run()</b>. They cannot be changed after that (i.e. after <b>run()</b> has been called at least once), since the integrator maintains a history of the collective variables also in between multiple calls to the <b>run()</b> command. The only way to reset metadynamics integration is to use another <a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html" title="Enables integration using metadynamics, a free energy technique.">integrate.mode_metadynamics</a> instance instead of the original one.</dd></dl>
<p>Two modes of operation are supported:</p>
<ol type="1">
<li>Resummation of Gaussians every time step</li>
<li>Evaluation of the bias potential on a grid</li>
</ol>
<p>In the first mode, the integration will slow down with increasing simulation time, as the number of Gaussians increases with time.</p>
<p>In the second mode, a current grid of values of the collective variables is maintained and updated whenever a new Gaussian is deposited. This avoids the slowing down, and this mode is thus preferrable for long simulations. However, a reasonable of grid points has to be chosen for accuracy (typically on the order of 200-500, depending on the collective variable and the system under study).</p>
<p>It is possible to output the grid after the simulation, and to restart from the grid file. It is also possible to restart from the grid file and turn off the deposition of new Gaussians, e.g. to equilibrate the system in the bias potential landscape and measure the histogram of the collective variable, to correct for errors.</p>
<dl class="section note"><dt>Note:</dt><dd>Grid mode is automatically enabled when it is specified for all collective variables simultaneously. Otherwise, it has to be disabled for all collective variables at the same time.</dd></dl>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="namespacemetadynamics_1_1cv.html" title="Defines the collective variables used for metadynamics integration.">metadynamics.cv</a></dd></dl>
<p>In the following, we give an example for using metadynamics in a diblock copolymer system.</p>
<p>This sets up metadynamics with Gaussians of height <img class="formulaInl" alt="$ W =1 $" src="form_29.png"/> (in energy units), which are deposited every <img class="formulaInl" alt="$t_G/\Delta t=5000$" src="form_30.png"/> steps ( <img class="formulaInl" alt="$\Delta t = 0.005$" src="form_31.png"/> in time units), with a well-tempered metadynamics temperature shift <img class="formulaInl" alt="$\Delta T = 7 $" src="form_32.png"/> (in temperature units). The collective variable is a lamellar order parameter. At the end of the simulation, the bias potential is saved into a file.</p>
<div class="fragment"><div class="line"> all = group.all</div>
<div class="line"> meta = <a class="code" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html" title="Enables integration using metadynamics, a free energy technique.">metadynamics.integrate.mode_metadynamics</a>(dt=0.005, W=1,stride=5000, deltaT=dT)</div>
<div class="line"></div>
<div class="line"> <span class="comment"># Use the NVT integration method </span></div>
<div class="line"> integrate.nvt(group=all, T=1, tau=0.5)</div>
<div class="line"></div>
<div class="line"> <span class="comment"># set up a collective variable on a grid</span></div>
<div class="line"> lamellar = <a class="code" href="classmetadynamics_1_1cv_1_1lamellar.html" title="Lamellar order parameter as a collective variable to study phase transitions in block copolymer syste...">metadynamics.cv.lamellar</a>(sigma=0.05, mode=dict(A=1.0, B=-1.0), lattice_vectors=[(0,0,3)], phi=[0.0])</div>
<div class="line"> lamellar.enable_grid(cv_min=-2.0, cv_max=2.0, num_points=400)</div>
<div class="line"></div>
<div class="line"> <span class="comment"># Run the metadynamics simulation for 10^5 time steps</span></div>
<div class="line"> run(1e5)</div>
<div class="line"></div>
<div class="line"> <span class="comment"># dump bias potential</span></div>
<div class="line"> meta.dump_grid(<span class="stringliteral">&quot;grid.dat&quot;</span>)</div>
</div><!-- fragment --><p>If the saved bias potential should be used to continue the simulation from, this can be accomplished by the following piece of code </p>
<div class="fragment"><div class="line"> meta = <a class="code" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html" title="Enables integration using metadynamics, a free energy technique.">metadynamics.integrate.mode_metadynamics</a>(dt=0.005, W=1,</div>
<div class="line"> integrate.nvt(group=all, T=1, tau=0.5)</div>
<div class="line"></div>
<div class="line"> <span class="comment"># set up a collective variable on a grid</span></div>
<div class="line"> lamellar = <a class="code" href="classmetadynamics_1_1cv_1_1lamellar.html" title="Lamellar order parameter as a collective variable to study phase transitions in block copolymer syste...">metadynamics.cv.lamellar</a>(sigma=0.05, mode=dict(A=1.0, B=-1.0), lattice_vectors=[(0,0,3)], phi=[0.0])</div>
<div class="line"> lamellar.enable_grid(cv_min=-2.0, cv_max=2.0, num_points=400)</div>
<div class="line"> </div>
<div class="line"> <span class="comment"># restart from saved bias potential</span></div>
<div class="line"> meta.restart_from_grid(<span class="stringliteral">&quot;grid.dat&quot;</span>)</div>
<div class="line"> run(1e5)</div>
</div><!-- fragment --> </div><div class="dynheader">
Inheritance diagram for mode_metadynamics:</div>
<div class="dyncontent">
<div class="center"><img src="classmetadynamics_1_1integrate_1_1mode__metadynamics__inherit__graph.png" border="0" usemap="#mode__metadynamics_inherit__map" alt="Inheritance graph"/></div>
<map name="mode__metadynamics_inherit__map" id="mode__metadynamics_inherit__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classmetadynamics_1_1integrate_1_1mode__metadynamics-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac775ee34451fdfa742b318538164070e"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html#ac775ee34451fdfa742b318538164070e">__init__</a></td></tr>
<tr class="memdesc:ac775ee34451fdfa742b318538164070e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Specifies the metadynamics integration mode.  <a href="#ac775ee34451fdfa742b318538164070e"></a><br/></td></tr>
<tr class="memitem:ab078fc302f2c867945220c0827e19de0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab078fc302f2c867945220c0827e19de0"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>update_forces</b></td></tr>
<tr class="memitem:ad5b92b23bdcade4390b17a0e59cae34f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html#ad5b92b23bdcade4390b17a0e59cae34f">dump_grid</a></td></tr>
<tr class="memdesc:ad5b92b23bdcade4390b17a0e59cae34f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dump information about the bias potential If a grid has been previously defined for the collective variables, this method dumps the values of the bias potential evaluated on the grid points to a file, for later restart or analysis.  <a href="#ad5b92b23bdcade4390b17a0e59cae34f"></a><br/></td></tr>
<tr class="memitem:ab95fa3af3f090b0f91a202097db51278"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html#ab95fa3af3f090b0f91a202097db51278">restart_from_grid</a></td></tr>
<tr class="memdesc:ab95fa3af3f090b0f91a202097db51278"><td class="mdescLeft">&#160;</td><td class="mdescRight">Restart from a previously saved grid file This command may be used before starting the simulation with the run() command.  <a href="#ab95fa3af3f090b0f91a202097db51278"></a><br/></td></tr>
<tr class="memitem:a364cc0c51947fb82516c240883c60d3d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmetadynamics_1_1integrate_1_1mode__metadynamics.html#a364cc0c51947fb82516c240883c60d3d">set_params</a></td></tr>
<tr class="memdesc:a364cc0c51947fb82516c240883c60d3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set parameters of the integration.  <a href="#a364cc0c51947fb82516c240883c60d3d"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a08ed18d66af9978ffa018faee9030458"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a08ed18d66af9978ffa018faee9030458"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>cpp_integrator</b></td></tr>
<tr class="memitem:a1e37d8181e815797950ae1daf49ada73"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1e37d8181e815797950ae1daf49ada73"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>supports_methods</b></td></tr>
<tr class="memitem:a4b70b10404d7f07c2a9ee7ecd6c55d24"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4b70b10404d7f07c2a9ee7ecd6c55d24"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>cv_names</b></td></tr>
</table>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ac775ee34451fdfa742b318538164070e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def __init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>W</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>stride</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>deltaT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>filename</em> = <code>&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>overwrite</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_hills</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Specifies the metadynamics integration mode. </p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">dt</td><td>Each time step of the simulation run() will advance the real time of the system forward by <em>dt</em> (in time units) </td></tr>
    <tr><td class="paramname">W</td><td>Height of Gaussians (in energy units) deposited </td></tr>
    <tr><td class="paramname">stride</td><td>Interval (number of time steps) between depositions of Gaussians </td></tr>
    <tr><td class="paramname">deltaT</td><td>Temperature shift (in temperature units) for well-tempered metadynamics </td></tr>
    <tr><td class="paramname">filename</td><td>(optional) Name of the log file to write hills information to </td></tr>
    <tr><td class="paramname">overwrite</td><td>(optional) True if the hills file should be overwritten </td></tr>
    <tr><td class="paramname">add_hills</td><td>(optional) True if Gaussians should be deposited during the simulation </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad5b92b23bdcade4390b17a0e59cae34f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def dump_grid </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dump information about the bias potential If a grid has been previously defined for the collective variables, this method dumps the values of the bias potential evaluated on the grid points to a file, for later restart or analysis. </p>
<p>This method can be used after the simulation has been run.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>The file to dump the information to </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab95fa3af3f090b0f91a202097db51278"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def restart_from_grid </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Restart from a previously saved grid file This command may be used before starting the simulation with the run() command. </p>
<p>Upon start of the simulation, the supplied grid file is then read in and used to initialize the bias potential.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>The file to read, which has been previously generated by dump_grid </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a364cc0c51947fb82516c240883c60d3d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def set_params </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_hills</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set parameters of the integration. </p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">add_hills</td><td>True if new Gaussians should be added during the simulation </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>integrate.py</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 27 2012 14:48:32 for metadynamics by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.1
</small></address>
</body>
</html>
